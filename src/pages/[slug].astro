---
import Layout from '../layouts/Layout.astro';
import projects from '../data/projects.json'; 
import Navbar from "../components/Navbar.astro";



export async function getStaticPaths() {
  return projects.map((project) => ({
    params: { 
      slug: String(project.id), 
    },
    props: { 
      projectData: project 
    },
  }));
}

const { projectData } = Astro.props;
const { title, description, pdfLink, galleryImages } = projectData;

const mainImage = galleryImages[0];
const secondaryImages = galleryImages.slice(1);
---
<head>
  <meta charset="UTF-8">
</head>
<Navbar />

<Layout title={title}>
  <article class="project-detail-container">
    <header class="project-header">
      <h1>{title}</h1>
      
      {pdfLink && (
        <a href={pdfLink} target="_blank" rel="noopener noreferrer" class="live-link project-button">
          Ver proyecto original
        </a>
      )}
    </header>

    <div class="project-content">
      <p class="description-text">{description}</p>
      
      <section class="project-gallery">
        <h2>Galer√≠a de proyecto</h2>
        
        <div class="main-image-display">
          <img src={mainImage} alt={`Imagen principal de ${title}`} id="gallery-main-image" class="detail-image" />
        </div>
        
        <div class="thumbnail-selector">
          {galleryImages.map((imgUrl, index) => (
            <img 
              src={imgUrl} 
              alt={`Miniatura ${index + 1}`} 
              class={`thumbnail-image ${index === 0 ? 'active' : ''}`}
              data-img-url={imgUrl}
            />
          ))}
        </div>
      </section>

    </div>
  </article>
</Layout>

<script>
  import { gsap } from "gsap";

  document.addEventListener("DOMContentLoaded", () => {
    
    const mainImage = document.getElementById('gallery-main-image') as HTMLImageElement; 
    const thumbnails = document.querySelectorAll('.thumbnail-image') as NodeListOf<HTMLElement>; 

    if (!mainImage || thumbnails.length === 0) return;

    thumbnails.forEach(thumbnail => {
      thumbnail.addEventListener('click', () => {
        
       
        const newUrl = thumbnail.getAttribute('data-img-url')!; 
        
        thumbnails.forEach(t => t.classList.remove('active'));
        thumbnail.classList.add('active');

        gsap.to(mainImage, {
          opacity: 0,
          duration: 0.3,
          onComplete: () => {
            mainImage.src = newUrl; 
            
            gsap.to(mainImage, {
              opacity: 1,
              duration: 0.5
            });
          }
        });
      });
    });
  });
</script>

<style>
    .project-detail-container {
        max-width: 900px;
        margin: 50px auto;
        padding: 2rem;
        background: white;
        border-radius: 10px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
        font-family: 'Poppins', sans-serif;
    }
    .project-header h1 {
        font-size: 2.5rem;
        margin-bottom: 0.5rem;
    }
    .project-button {
        background-color: hotpink;
        color: white;
        padding: 10px 20px;
        border-radius: 5px;
        text-decoration: none;
        font-weight: 600;
        display: inline-block;
        transition: background-color 0.3s ease;
    }
    .project-button:hover {
        background-color: rgb(224, 52, 138);
    }

    .detail-image {
        width: 100%;
        max-height: 500px;
        object-fit: contain;
        border-radius: 8px;
    }
    .description-text {
        font-size: 1.1rem;
        line-height: 1.8;
        margin-top: 1.5rem;
    }
    
    .project-gallery {
        margin-top: 3rem;
        border-top: 1px solid #eee;
        padding-top: 2rem;
    }
    .main-image-display {
        overflow: hidden;
        border-radius: 8px;
        margin-bottom: 1rem;
    }
    .thumbnail-selector {
        display: flex;
        gap: 10px;
        overflow-x: auto;
        padding-bottom: 10px;
    }
    .thumbnail-image {
        width: 80px;
        height: 60px;
        object-fit: cover;
        border-radius: 4px;
        cursor: pointer;
        border: 3px solid transparent;
        transition: border-color 0.2s ease;
    }
    .thumbnail-image:hover, .thumbnail-image.active {
        border-color: #ff54e2;
    }
</style>